os: linux
dist: xenial
services:
- xvfb
git:
  depth: 3
  submodules: true
language: python
python:
- '2.7'
- '3.7'
matrix:  # macos can't be listed in 'os' as we need to set 'generic' as language (because travis doesn't support python on macos for now)
  include:
  - os: osx
    osx_image: xcode10.2  # Xcode: 10.2.1  |  macOS: 10.14
    language: generic
jdk: openjdk8
cache: pip
deploy:
  provider: releases
  api_key:
    secure: ILf+mnaXPZ658G7/hd4RLY1gH8gCiSc8IpI4/rlkvrLWNl55tkIqsitcavayTsBOeqE2GA1SHk0t7BlauLpNg73G7KcL6VjRVAaEo5cNz5i/pABvK4RgPskksrLTCqlT3rL/xUGm5b3RyJno9RvjQjw7AygSdFQhE2buU4bZgbOfSc16ZhU6Nm7X7HZ3t2rh5jv1nYf1mV9cskn1Xl2zqzPjLjww4T98bOVMzKrO/QYR8EZ4YocGyy0Hd6iY++G7Xtz5F9PgZVCptI9KzEm1r3/CAxr1JO4LJ2Ok3v7xp7AIjHLM/mYDOKDBrS+xnvRUHaSXCPKfrhdDiGFE3DYj1153xnl2QLpljqYi/upnjQ0Cnnp7p/mmpvqWP2Ci5L6LtvzbHQaFbkWCY83jYr5Mi0z0pC5BsVvz+E4bq5tzrp2iX0NUc0mrPM7PK/b0QFR2ibjeMl4yNh0Z7zJ/24XSRehD4VbB/R2e0RKo0tXVAwR0fIRMgMhYYDEms8/PFwwkcACdLkKkdywRoCkVSjAPHDoQ/BNUDoWY21AOjnBrU4kQIg8n2T5or30YHhcCkEfe4YaLqJ+ikTZPlT9H6HgGeZhJMadj0GBu/vn2s7jc5DtudhGPua6U2tTyzm+qyzFusjILueO5Lk0CaCy2qwf4bjuiBS+xKtdsCsOFRBI0l9U=
  file: distribution/webots-R2019a-rev2-x86-64.tar.bz2
  skip_cleanup: true
  draft: true
  on:
    repo: omichel/webots
    branch: travis-releases
before_install:
- if [ $TRAVIS_OS_NAME = linux ]; then sudo add-apt-repository ppa:deadsnakes/ppa -y; fi
- if [ $TRAVIS_OS_NAME = linux ]; then sudo apt update; fi
- if [ $TRAVIS_OS_NAME = linux ]; then sudo apt install python3.6-dev python3.7-dev; fi
- if [ $TRAVIS_OS_NAME = linux ]; then curl -sL https://deb.nodesource.com/setup_10.x | sudo -E bash -; fi
- if [ $TRAVIS_OS_NAME = linux ]; then sudo apt install nodejs; fi
install:
- pip install -r tests/sources/requirements.txt
- pip install -r docs/tests/requirements.txt
addons:
  apt:
    packages:
    - clang-format-5.0
    - g++
    - cmake
    - libusb-dev
    - swig
    - python2.7-dev
    - libglu1-mesa-dev
    - libglib2.0-dev
    - libfreeimage-dev
    - libfreetype6-dev
    - libxml2-dev
    - libzzip-0-13
    - libssl-dev
    - libboost-dev
    - libjpeg8-dev
    - libavcodec-extra
    - libpci-dev
    - libgd-dev
    - libtiff5-dev
    - libssh-dev
    - libzip-dev
    - python-pip
    - libreadline-dev
    - libassimp-dev
    - libpng12-dev
    - libav-tools
    - python3.5-dev
    - openjdk-8-jdk
    - curl
    - libwebpdemux1
    - fakeroot
  homebrew:
    packages:
    - clang-format
    - cppcheck
    - python
    - cmake
    - swig
    - wget
    - node
script:
- if [ $TRAVIS_OS_NAME = linux ]; then export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64; else export JAVA_HOME="$(/usr/libexec/java_home -v 1.8)"; fi
- export QT_QPA_PLATFORM=offscreen
- travis_wait 45 make distrib -j2
